<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - YogaLife</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/profile.css">
    <style>
         .bookings-container {
                        margin-top: 20px;
                    }
                    
                    .table {
                        width: 100%;
                        margin-bottom: 1rem;
                        background-color: transparent;
                        border-collapse: separate;
                        border-spacing: 0 8px;
                    }
                    
                    .table th {
                        padding: 1rem;
                        vertical-align: middle;
                        border-top: none;
                        background-color: #f8f9fa;
                        font-weight: 600;
                        color: #495057;
                    }
                    
                    .table td {
                        padding: 1rem;
                        vertical-align: middle;
                        border-top: 1px solid #dee2e6;
                        background-color: white;
                    }
                    
                    .table tbody tr {
                        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                        transition: all 0.2s;
                    }
                    
                    .table tbody tr:hover {
                        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                        transform: translateY(-2px);
                    }
                    
                    .badge {
                        padding: 0.5em 0.75em;
                        font-size: 0.75em;
                        font-weight: 500;
                        border-radius: 0.25rem;
                    }
                    
                    .text-muted {
                        color: #6c757d;
                        font-size: 0.875em;
                    }
                    
                    .articles-container {
                        margin-top: 20px;
                    }
                    
                    .article-status {
                        padding: 0.25em 0.6em;
                        font-size: 0.75em;
                        font-weight: 500;
                        border-radius: 0.25rem;
                    }
                    
                    .status-published {
                        background-color: #28a745;
                        color: white;
                    }
                    
                    .status-pending {
                        background-color: #ffc107;
                        color: #000;
                    }
                    
                    .status-rejected {
                        background-color: #dc3545;
                        color: white;
                    }
                    
                    .delete-btn {
                        background-color: #dc3545;
                        color: white;
                        border: none;
                        padding: 0.25rem 0.5rem;
                        border-radius: 0.25rem;
                        cursor: pointer;
                    }
                    
                    .delete-btn:hover {
                        background-color: #c82333;
                    }

                    .article-title {
                        max-width: 250px;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        white-space: nowrap;
                    }
                    
                    .stat-card {
                        background: #fff;
                        border-radius: 8px;
                        padding: 20px;
                        text-align: center;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        margin-bottom: 20px;
                    }

                    .stat-card h4 {
                        color: #666;
                        font-size: 14px;
                        margin-bottom: 10px;
                    }

                    .stat-card p {
                        color: #333;
                        font-size: 24px;
                        font-weight: bold;
                        margin: 0;
                    }

                    .article-status {
                        display: inline-block;
                        padding: 4px 8px;
                        border-radius: 4px;
                        font-size: 12px;
                        font-weight: 500;
                    }

                    .status-published {
                        background-color: #28a745;
                        color: white;
                    }

                    .status-pending {
                        background-color: #ffc107;
                        color: black;
                    }

                    .status-rejected {
                        background-color: #dc3545;
                        color: white;
                    }

                    .delete-btn {
                        padding: 4px 12px;
                        background-color: #dc3545;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }

                    .delete-btn:hover {
                        background-color: #c82333;
                    }

                    .mb-4 {
                        margin-bottom: 1.5rem;
                    }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h1>YogaLife</h1>
        </div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/articles.html">Articles</a>
            <a href="/events.html">Events</a>
            <div class="user-profile">
                <a href="/profile.html" class="profile-link active">My Profilee</a>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>
    </nav>

    <main style="margin-top: 80px;">
        <div class="profile-container">
            <div class="profile-header">
                <!-- <h2>My Profile</h2> -->
                <form id="profileForm">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                  
                </form>
                <p id="verificationStatus"></p>
            </div>

            <div class="profile-content">
                <div class="profile-section">
                    <h3>Personal Information</h3>
                    <form id="profileForm">
                        <div class="form-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <button type="submit" class="btn">Update Profile</button>
                    </form>
                </div>

                <div class="profile-section" id="verificationSection">
                    <h3>Author Verification</h3>
                    <div id="verificationForm" class="form-container">
                        <form id="authorVerificationForm">
                            <div class="form-group">
                                <label for="experience">Years of Yoga Experience</label>
                                <input type="number" id="experience" name="experience" required>
                            </div>
                            <div class="form-group">
                                <label for="certifications">Certifications (comma-separated)</label>
                                <input type="text" id="certifications" name="certifications">
                            </div>
                            <div class="form-group">
                                <label for="teachingExperience">Teaching Experience</label>
                                <textarea id="teachingExperience" name="teachingExperience" rows="4"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="specializations">Specializations (comma-separated)</label>
                                <input type="text" id="specializations" name="specializations">
                            </div>
                            <button type="submit" class="btn">Submit for Verification</button>
                        </form>
                    </div>
                </div>

                <div class="profile-section" id="articleSection">
                    <h3>Share Article</h3>
                    
                    <!-- Verification Status Message -->
                    <div id="verificationStatusMessage" class="verification-message" style="display: none; margin-bottom: 15px;">
                        <p id="verificationMessageText" style="padding: 10px; border-radius: 5px;"></p>
                    </div>

                    <form id="articleForm">
                        <!-- Verification Warning -->
                        <div id="verificationWarning" style="display: none; background-color: #fff3cd; color: #856404; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
                            Your account needs to be verified before you can submit articles. Please contact support.
                        </div>

                        <div class="form-group">
                            <label for="articleTitle">Title</label>
                            <input type="text" id="articleTitle" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="articleImage">Article Image</label>
                            <input type="file" id="articleImage" name="image" accept="image/*" required>
                            <small>Please upload a relevant image for your article</small>
                        </div>
                        <div class="form-group">
                            <label for="articleCategory">Category</label>
                            <select id="articleCategory" name="category" required>
                                <option value="yogabhyas">Yogabhyas</option>
                                <option value="yogicdiet">Yogic Diet</option>
                                <option value="yogicscripture">Yogic Scripture</option>
                                <option value="satkarma">Satkarma</option>
                                <option value="meditation">Meditation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="articleContent">Content</label>
                            <textarea id="articleContent" name="content" rows="15" required></textarea>
                            <small>Write your detailed article content here. You can use paragraphs to organize your content better.</small>
                        </div>
                        <button type="submit" id="submitArticleBtn" class="btn btn-primary" disabled>Submit Article for Review</button>
                    </form>
                    <div id="articleMessage" class="message" style="display: none;"></div>
                </div>

                <!-- <div class="profile-section">
                    <h3>My Bookings</h3>
                    <div id="userBookings">
                         Bookings will be loaded dynamically 
                    </div>
                </div> -->

                <!-- <div class="container mt-5">
                    <div class="profile-header mb-4">
                        <h2>My Articles</h2>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <div id="articlesContainer">
                                        Articles will be loaded here
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>
            <div class="profile-section" id="bookingsSection">
                <h3>My Event Bookings</h3>
                <div class="bookings-container">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Event</th>
                                    <th>Tickets</th>
                                    <th>Total Amount</th>
                                    <th>Booking Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTableBody">
                                <!-- Bookings will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="profile-section" id="articlesSection">
                <h3>My Articles</h3>
                <div class="articles-stats mb-4">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="stat-card">
                                <h4>Total Articles</h4>
                                <p id="totalArticles">0</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <h4>Published</h4>
                                <p id="publishedArticles">0</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <h4>Pending</h4>
                                <p id="pendingArticles">0</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <h4>Rejected</h4>
                                <p id="rejectedArticles">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="articles-container">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                    <th>Published Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="articlesTableBody">
                                <!-- Articles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="profile-section" id="myArticlesSection" style="display: none;">
                <h3>My Published Articles</h3>
                <div class="articles-container">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                    <th>Published Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="articlesTableBody">
                                <!-- Articles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About Us</h3>
                <p>We are dedicated to spreading the knowledge of yoga and meditation to enhance lives globally.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="/articles.html">Articles</a></li>
                    <li><a href="/events.html">Events</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p>Email: info@yogalife.com</p>
                <p>Phone: +1 234 567 890</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 YogaLife. All rights reserved.</p>
        </div>
    </footer>

    <script src="/js/auth.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/profile.js"></script>
    <script>
        async function loadUserArticles() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/articles/user/articles', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load articles');
                }

                const articles = await response.json();
                const container = document.getElementById('articlesContainer');

                if (articles.length === 0) {
                    container.innerHTML = '<div class="alert alert-info">You haven\'t written any articles yet.</div>';
                    return;
                }

                container.innerHTML = articles.map(article => {
                    let statusBadge = '';
                    let statusMessage = '';

                    switch(article.status) {
                        case 'approved':
                            statusBadge = '<span class="badge bg-success">Published</span>';
                            statusMessage = '<div class="alert alert-success mt-2">Your article has been approved and published!</div>';
                            break;
                        case 'rejected':
                            statusBadge = '<span class="badge bg-danger">Not Approved</span>';
                            statusMessage = '<div class="alert alert-danger mt-2">Your article was not approved. Please review our content guidelines and consider submitting a new article.</div>';
                            break;
                        case 'pending':
                            statusBadge = '<span class="badge bg-warning text-dark">Under Review</span>';
                            statusMessage = '<div class="alert alert-info mt-2">Your article is currently under review. We\'ll notify you once it\'s reviewed.</div>';
                            break;
                        default:
                            statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                    }

                    return `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">${article.title}</h5>
                                    ${statusBadge}
                                </div>
                                <p class="card-text">${article.description}</p>
                                ${statusMessage}
                                <div class="text-muted mt-2">
                                    <small>Submitted on: ${new Date(article.createdAt).toLocaleDateString()}</small>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading articles:', error);
                document.getElementById('articlesContainer').innerHTML = 
                    '<div class="alert alert-danger">Error loading articles. Please try again later.</div>';
            }
        }

        // Load articles when page loads
        document.addEventListener('DOMContentLoaded', loadUserArticles);

         // Function to load user's bookings
         async function loadUserBookings() {
            const tableBody = document.getElementById('bookingsTableBody');
            try {
                const token = localStorage.getItem('token');
                console.log('Token exists:', !!token);
                
                if (!token) {
                    throw new Error('No authentication token found');
                }

                console.log('Fetching bookings...');
                const response = await fetch('/api/bookings/user', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Response status:', response.status);

                if (response.status === 401) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Please login again');
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Error data:', errorData);
                    throw new Error(errorData.error + (errorData.details ? ': ' + errorData.details : ''));
                }

                const bookings = await response.json();
                console.log('Bookings received:', bookings?.length);

                if (!bookings || bookings.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No bookings found</td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = '';
                bookings.forEach(booking => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <strong>${booking.event?.title || 'Event Deleted'}</strong>
                        </td>
                        <td>
                            ${booking.tickets.map(t => `
                                <div>
                                    <strong>${t.quantity} x ${t.ticketType?.name || 'Unknown Ticket'}</strong>
                                    <div class="text-muted">₹${t.ticketType?.price || 0} each</div>
                                </div>
                            `).join('')}
                        </td>
                        <td>
                            <strong>₹${booking.totalAmount || 0}</strong>
                        </td>
                        <td>
                            ${new Date(booking.createdAt).toLocaleDateString('en-IN', {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric'
                            })}
                        </td>
                        <td>
                            <span class="badge bg-${booking.paymentDetails?.status === 'completed' ? 'success' : 'warning'}">
                                ${booking.paymentDetails?.status === 'completed' ? 'Confirmed' : 'Pending'}
                            </span>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading bookings:', error);
                let errorMessage = error.message || 'Failed to load bookings. Please try again later.';
                
                if (error.message.includes('No authentication token') || 
                    error.message.includes('Please login') || 
                    error.message.includes('Please authenticate')) {
                    errorMessage = 'Please <a href="/login.html">login</a> to view your bookings';
                    localStorage.removeItem('token');
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 2000);
                }

                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-danger">
                            ${errorMessage}
                        </td>
                    </tr>
                `;
            }
        }

        // Load bookings when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Loading user bookings...');
            loadUserBookings();
        });
         
                   
    </script>
    <script>
        async function loadArticles() {
            const articlesSection = document.getElementById('articlesSection');
            const tableBody = document.getElementById('articlesTableBody');
            
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    console.error('No authentication token found');
                    throw new Error('Please log in to view your articles');
                }

                console.log('Fetching articles...');
                const response = await fetch('/api/articles/user/articles', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('Response status:', response.status);
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Server error:', errorData);
                    throw new Error(errorData.error || 'Failed to fetch articles');
                }

                const articles = await response.json();
                console.log('Articles received:', articles);
                
                // Update stats
                const stats = {
                    total: articles.length,
                    published: articles.filter(a => a.status === 'published').length,
                    pending: articles.filter(a => a.status === 'pending').length,
                    rejected: articles.filter(a => a.status === 'rejected').length
                };

                document.getElementById('totalArticles').textContent = stats.total;
                document.getElementById('publishedArticles').textContent = stats.published;
                document.getElementById('pendingArticles').textContent = stats.pending;
                document.getElementById('rejectedArticles').textContent = stats.rejected;

                // Show section if user is verified
                const user = JSON.parse(localStorage.getItem('user'));
                if (user && user.isVerified) {
                    articlesSection.style.display = 'block';
                }

                if (!articles || articles.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No articles found</td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = '';
                articles.forEach(article => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${article.title || 'Untitled'}</td>
                        <td>${article.category || 'Uncategorized'}</td>
                        <td>
                            <span class="article-status status-${(article.status || 'pending').toLowerCase()}">
                                ${(article.status || 'Pending').charAt(0).toUpperCase() + (article.status || 'pending').slice(1)}
                            </span>
                        </td>
                        <td>${article.createdAt ? new Date(article.createdAt).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button class="delete-btn" onclick="deleteArticle('${article._id}')">
                                Delete
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading articles:', error);
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-danger">
                            ${error.message || 'Failed to load articles. Please try again later.'}
                        </td>
                    </tr>
                `;
            }
        }

        async function deleteArticle(articleId) {
            try {
                if (!confirm('Are you sure you want to delete this article?')) {
                    return;
                }

                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('Please log in to delete articles');
                }

                console.log('Deleting article:', articleId);
                const response = await fetch(`/api/articles/user/articles/${articleId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('Delete response status:', response.status);
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Server error:', errorData);
                    throw new Error(errorData.error || 'Failed to delete article');
                }

                showToast('success', 'Article deleted successfully');
                loadArticles(); // Reload the articles list
            } catch (error) {
                console.error('Error deleting article:', error);
                showToast('error', error.message || 'Failed to delete article');
            }
        }

        // Load articles when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadArticles();
        });
    </script>
    <script>
        async function loadUserArticles() {
            const articlesContainer = document.getElementById('userArticlesContainer');
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found');
                }

                const response = await fetch('/api/articles/user/articles', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch articles');
                }

                const articles = await response.json();
                
                // Only show the section if user has articles or is verified
                const user = JSON.parse(localStorage.getItem('user'));
                if (user && user.isVerified) {
                    articlesContainer.style.display = 'block';
                }

                if (!articles || articles.length === 0) {
                    articlesContainer.innerHTML = `
                        <div class="alert alert-info">You haven't written any articles yet.</div>
                    `;
                    return;
                }

                articlesContainer.innerHTML = '';
                articles.forEach(article => {
                    let statusBadge = '';
                    let statusMessage = '';

                    switch(article.status) {
                        case 'approved':
                            statusBadge = '<span class="badge bg-success">Published</span>';
                            statusMessage = '<div class="alert alert-success mt-2">Your article has been approved and published!</div>';
                            break;
                        case 'rejected':
                            statusBadge = '<span class="badge bg-danger">Not Approved</span>';
                            statusMessage = '<div class="alert alert-danger mt-2">Your article was not approved. Please review our content guidelines and consider submitting a new article.</div>';
                            break;
                        case 'pending':
                            statusBadge = '<span class="badge bg-warning text-dark">Under Review</span>';
                            statusMessage = '<div class="alert alert-info mt-2">Your article is currently under review. We\'ll notify you once it\'s reviewed.</div>';
                            break;
                        default:
                            statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                    }

                    const articleHTML = `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">${article.title}</h5>
                                    ${statusBadge}
                                </div>
                                <p class="card-text">${article.description}</p>
                                ${statusMessage}
                                <div class="text-muted mt-2">
                                    <small>Submitted on: ${new Date(article.createdAt).toLocaleDateString()}</small>
                                </div>
                            </div>
                        </div>
                    `;
                    articlesContainer.innerHTML += articleHTML;
                });
            } catch (error) {
                console.error('Error loading articles:', error);
                articlesContainer.innerHTML = 
                    '<div class="alert alert-danger">Error loading articles. Please try again later.</div>';
            }
        }

        // Load articles when page loads
        document.addEventListener('DOMContentLoaded', loadUserArticles);

        // Function to load user's articles
        async function loadUserArticles() {
            const articlesSection = document.getElementById('myArticlesSection');
            const tableBody = document.getElementById('articlesTableBody');
            
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found');
                }

                const response = await fetch('/api/articles/user/articles', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch articles');
                }

                const articles = await response.json();
                
                // Only show the section if user has articles or is verified
                const user = JSON.parse(localStorage.getItem('user'));
                if (user && user.isVerified) {
                    articlesSection.style.display = 'block';
                }

                if (!articles || articles.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No articles published yet</td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = '';
                articles.forEach(article => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="article-title" title="${article.title}">
                                ${article.title}
                            </div>
                        </td>
                        <td>${article.category}</td>
                        <td>
                            <span class="article-status status-${article.status.toLowerCase()}">
                                ${article.status}
                            </span>
                        </td>
                        <td>
                            ${new Date(article.createdAt).toLocaleDateString('en-IN', {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric'
                            })}
                        </td>
                        <td>
                            <button class="delete-btn" onclick="deleteArticle('${article._id}')">
                                Delete
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading articles:', error);
                if (tableBody) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center text-danger">
                                Failed to load articles. Please try again later.
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // Function to delete an article
        async function deleteArticle(articleId) {
            try {
                if (!confirm('Are you sure you want to delete this article?')) {
                    return;
                }

                const token = localStorage.getItem('token');
                const response = await fetch(`/api/articles/user/articles/${articleId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to delete article');
                }

                // Reload articles after successful deletion
                loadUserArticles();
                showToast('success', 'Article deleted successfully');
            } catch (error) {
                console.error('Error deleting article:', error);
                showToast('error', 'Failed to delete article');
            }
        }

        // Load articles when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadUserArticles();
        });
    </script>
    <script>
        async function loadArticles() {
            const articlesSection = document.getElementById('articlesSection');
            const tableBody = document.getElementById('articlesTableBody');
            
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found');
                }

                const response = await fetch('/api/articles/user/articles', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch articles');
                }

                const articles = await response.json();
                
                // Update stats
                const stats = {
                    total: articles.length,
                    published: articles.filter(a => a.status === 'published').length,
                    pending: articles.filter(a => a.status === 'pending').length,
                    rejected: articles.filter(a => a.status === 'rejected').length
                };

                document.getElementById('totalArticles').textContent = stats.total;
                document.getElementById('publishedArticles').textContent = stats.published;
                document.getElementById('pendingArticles').textContent = stats.pending;
                document.getElementById('rejectedArticles').textContent = stats.rejected;

                // Show section if user is verified
                const user = JSON.parse(localStorage.getItem('user'));
                if (user && user.isVerified) {
                    articlesSection.style.display = 'block';
                }

                if (!articles || articles.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No articles found</td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = '';
                articles.forEach(article => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${article.title}</td>
                        <td>${article.category}</td>
                        <td>
                            <span class="article-status status-${article.status.toLowerCase()}">
                                ${article.status.charAt(0).toUpperCase() + article.status.slice(1)}
                            </span>
                        </td>
                        <td>${new Date(article.createdAt).toLocaleDateString()}</td>
                        <td>
                            <button class="delete-btn" onclick="deleteArticle('${article._id}')">
                                Delete
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading articles:', error);
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-danger">
                            Failed to load articles. Please try again later.
                        </td>
                    </tr>
                `;
            }
        }

        async function deleteArticle(articleId) {
            try {
                if (!confirm('Are you sure you want to delete this article?')) {
                    return;
                }

                const token = localStorage.getItem('token');
                const response = await fetch(`/api/articles/user/articles/${articleId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to delete article');
                }

                showToast('success', 'Article deleted successfully');
                loadArticles(); // Reload the articles list
            } catch (error) {
                console.error('Error deleting article:', error);
                showToast('error', 'Failed to delete article');
            }
        }

        // Load articles when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadArticles();
        });
    </script>
</body>
</html>
